<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC23gdYyXTTFaShymYySFuKJBYgSbkamdY",
        authDomain: "gcm-salvador-portal.firebaseapp.com",
        projectId: "gcm-salvador-portal",
        storageBucket: "gcm-salvador-portal.firebasestorage.app",
        messagingSenderId: "578659251170",
        appId: "1:578659251170:web:7b79771e794a37f8fcffbb"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const matricula = user.email.split('@')[0];
            try {
                const docSnap = await getDoc(doc(db, "servidores", matricula));
                if (docSnap.exists()) {
                    const d = docSnap.data();
                    // Garante que o elemento existe antes de preencher
                    const elNome = document.getElementById('userName');
                    const elMat = document.getElementById('userMatricula');
                    
                    if(elNome) elNome.innerText = `OLÁ, ${d.nome_completo ? d.nome_completo.split(' ')[0] : 'SERVIDOR'}`;
                    if(elMat) elMat.innerText = `MATRÍCULA: ${d.matricula || matricula}`;
                } else {
                    console.error("Servidor não encontrado no banco!");
                }
            } catch (err) {
                console.error("Erro ao buscar dados:", err);
            }
        } else {
            window.location.href = "index.html";
        }
    });

    document.getElementById('btnLogout').onclick = () => signOut(auth);
</script>
