<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal GCM - Salvador</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a2a6c; --accent: #fdbb2d; --glass: rgba(255, 255, 255, 0.1); }
        body {
            margin: 0; font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('assets/fundo.jpg');
            background-size: cover; background-position: center; background-attachment: fixed;
            height: 100vh; display: flex; align-items: center; justify-content: center;
        }
        .login-card {
            background: var(--glass); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.2);
            padding: 3rem 2rem; border-radius: 25px; width: 90%; max-width: 380px; text-align: center;
        }
        .logo-gcm { width: 100px; margin-bottom: 1rem; }
        h2 { margin: 0; color: white; text-transform: uppercase; letter-spacing: 2px; }
        p { color: white; opacity: 0.8; font-size: 0.9rem; margin-bottom: 2rem; }
        .input-group { margin-bottom: 1.2rem; text-align: left; position: relative; }
        label { display: block; margin-bottom: 0.5rem; color: white; font-size: 0.8rem; font-weight: bold; }
        input {
            width: 100%; padding: 1rem; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.3); color: white; outline: none; box-sizing: border-box;
        }
        .toggle-password { position: absolute; right: 15px; top: 38px; color: white; cursor: pointer; opacity: 0.6; }
        button {
            width: 100%; padding: 1rem; border-radius: 12px; border: none; background: white;
            color: var(--primary); font-weight: 800; cursor: pointer; transition: 0.3s;
        }
        #customModal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); align-items: center; justify-content: center;
        }
        .modal-content { background: white; padding: 2rem; border-radius: 20px; text-align: center; max-width: 300px; }
        .modal-btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; width: 100%; cursor: pointer; }
        .shake { animation: shake 0.4s; }
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-10px);} 75% {transform: translateX(10px);} }
    </style>
</head>
<body>

    <div class="login-card" id="loginCard">
        <img src="assets/brasao.png" class="logo-gcm">
        <h2>Portal GCM</h2>
        <p>Acesso Restrito</p>
        <form id="loginForm">
            <div class="input-group">
                <label>Matrícula</label>
                <input type="text" id="matricula" inputmode="numeric" required placeholder="Somente números">
            </div>
            <div class="input-group">
                <label>Senha (CPF)</label>
                <input type="password" id="cpf" inputmode="numeric" required placeholder="Somente números">
                <i class="fas fa-eye toggle-password" id="toggleIcon"></i>
            </div>
            <button type="submit" id="btnEntrar">ENTRAR</button>
        </form>
    </div>

    <div id="customModal">
        <div class="modal-content">
            <h3 id="modalTitle">Aviso</h3>
            <p id="modalMsg"></p>
            <button class="modal-btn" id="closeBtn">OK</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC23gdYyXTTFaShymYySFuKJBYgSbkamdY",
            authDomain: "gcm-salvador-portal.firebaseapp.com",
            projectId: "gcm-salvador-portal",
            storageBucket: "gcm-salvador-portal.firebasestorage.app",
            messagingSenderId: "578659251170",
            appId: "1:578659251170:web:7b79771e794a37f8fcffbb"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const showModal = (t, m) => {
            document.getElementById('modalTitle').innerText = t;
            document.getElementById('modalMsg').innerText = m;
            document.getElementById('customModal').style.display = 'flex';
        };

        document.getElementById('closeBtn').onclick = () => document.getElementById('customModal').style.display = 'none';

        document.getElementById('toggleIcon').onclick = () => {
            const input = document.getElementById('cpf');
            const type = input.type === 'password' ? 'text' : 'password';
            input.type = type;
            document.getElementById('toggleIcon').classList.toggle('fa-eye-slash');
        };

        document.getElementById('loginForm').onsubmit = async (e) => {
            e.preventDefault();
            const mat = document.getElementById('matricula').value.trim();
            const cpf = document.getElementById('cpf').value.replace(/\D/g, '');
            const email = `${mat}@gcm.com`;
            const pass = cpf.length < 6 ? cpf.padEnd(6, '0') : cpf;
            const btn = document.getElementById('btnEntrar');

            btn.disabled = true;
            btn.innerText = "VERIFICANDO...";

            try {
                await signInWithEmailAndPassword(auth, email, pass);
                window.location.href = "painel.html";
            } catch (err) {
                try {
                    await createUserWithEmailAndPassword(auth, email, pass);
                    window.location.href = "painel.html";
                } catch (e2) {
                    document.getElementById('loginCard').classList.add('shake');
                    showModal("Erro", "Dados inválidos ou erro de conexão.");
                    setTimeout(() => document.getElementById('loginCard').classList.remove('shake'), 400);
                }
            } finally {
                btn.disabled = false;
                btn.innerText = "ENTRAR";
            }
        };
    </script>
</body>
</html>
